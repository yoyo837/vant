import{d as _,c as E,q as L,l as y,a as N}from"./use-translate-71d4880c.js";import{B as w}from"./index-2ad848b9.js";import{A as V,y as S,D as j,M as z,e as n,r as M,o as x,a as F,w as v,C as i,c as H,f as I,F as X}from"./vue-libs-19c20d28.js";import{m as b,a as Y,w as q}from"./with-install-560d59bf.js";import{V as A}from"./index-1122429d.js";import{s as J}from"./function-call-39062646.js";import"./use-route-751feeeb.js";import"./index-1ef61aa2.js";import"./index-8bc2514f.js";import"./index-2b75ebd8.js";import"./constant-ee6e27d7.js";import"./mount-component-b555bf78.js";import"./use-expose-80cfd2b2.js";import"./index-e88b099c.js";import"./use-lock-scroll-01f1fb06.js";import"./use-touch-4e22f945.js";import"./use-lazy-render-e63df66f.js";import"./on-popup-reopen-6f4c2d78.js";import"./use-scope-id-dc406604.js";import"./index-cd342d67.js";import"./interceptor-5424332a.js";const[$,k,B]=E("signature"),G={tips:String,type:b("png"),penColor:b("#000"),lineWidth:Y(3),clearButtonText:String,backgroundColor:b(""),confirmButtonText:String},K=()=>{var a;const o=document.createElement("canvas");return!!((a=o.getContext)!=null&&a.call(o,"2d"))},O=V({name:$,props:G,emits:["submit","clear","start","end","signing"],setup(o,{emit:a}){const r=S(),s=S(),e=j(()=>r.value?r.value.getContext("2d"):null),f=_?K():!0;let g=0,c=0,m;const T=()=>{if(!e.value)return!1;e.value.beginPath(),e.value.lineWidth=o.lineWidth,e.value.strokeStyle=o.penColor,m=L(r),a("start")},R=t=>{if(!e.value)return!1;y(t);const l=t.touches[0],u=l.clientX-((m==null?void 0:m.left)||0),d=l.clientY-((m==null?void 0:m.top)||0);e.value.lineCap="round",e.value.lineJoin="round",e.value.lineTo(u,d),e.value.stroke(),a("signing",t)},W=t=>{y(t),a("end")},P=t=>{const l=document.createElement("canvas");if(l.width=t.width,l.height=t.height,o.backgroundColor){const u=l.getContext("2d");C(u)}return t.toDataURL()===l.toDataURL()},C=t=>{t&&o.backgroundColor&&(t.fillStyle=o.backgroundColor,t.fillRect(0,0,g,c))},U=()=>{var d,p;const t=r.value;if(!t)return;const u=P(t)?"":((p=(d={jpg:()=>t.toDataURL("image/jpeg",.8),jpeg:()=>t.toDataURL("image/jpeg",.8)})[o.type])==null?void 0:p.call(d))||t.toDataURL(`image/${o.type}`);a("submit",{image:u,canvas:t})},D=()=>{e.value&&(e.value.clearRect(0,0,g,c),e.value.closePath(),C(e.value)),a("clear")};return z(()=>{var t,l,u;if(f&&r.value){const d=r.value,p=_?window.devicePixelRatio:1;g=d.width=(((t=s.value)==null?void 0:t.offsetWidth)||0)*p,c=d.height=(((l=s.value)==null?void 0:l.offsetHeight)||0)*p,(u=e.value)==null||u.scale(p,p),C(e.value)}}),()=>n("div",{class:k()},[n("div",{class:k("content"),ref:s},[f?n("canvas",{ref:r,onTouchstartPassive:T,onTouchmove:R,onTouchend:W},null):n("p",null,[o.tips])]),n("div",{class:k("footer")},[n(w,{size:"small",onClick:D},{default:()=>[o.clearButtonText||B("clear")]}),n(w,{type:"primary",size:"small",onClick:U},{default:()=>[o.confirmButtonText||B("confirm")]})])])}}),Q=q(O),h=Q,kt={__name:"index",setup(o){const a=N({"zh-CN":{penColor:"自定义颜色",lineWidth:"自定义线宽",backgroundColor:"自定义背景颜色"},"en-US":{penColor:"Pen Color",lineWidth:"Line Width",backgroundColor:"Background Color"}}),r=S(""),s=f=>{r.value=f.image},e=()=>J("clear");return(f,g)=>{const c=M("demo-block");return x(),F(X,null,[n(c,{title:i(a)("basicUsage")},{default:v(()=>[n(i(h),{onSubmit:s,onClear:e})]),_:1},8,["title"]),r.value?(x(),H(i(A),{key:0,src:r.value},null,8,["src"])):I("",!0),n(c,{title:i(a)("penColor")},{default:v(()=>[n(i(h),{"pen-color":"#ff0000",onClear:e,onSubmit:s})]),_:1},8,["title"]),n(c,{title:i(a)("lineWidth")},{default:v(()=>[n(i(h),{"line-width":6,onClear:e,onSubmit:s})]),_:1},8,["title"]),n(c,{title:i(a)("backgroundColor")},{default:v(()=>[n(i(h),{"background-color":"#eee",onClear:e,onSubmit:s})]),_:1},8,["title"])],64)}}};export{kt as default};
