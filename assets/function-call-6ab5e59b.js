import{m as ce,u as re}from"./mount-component-b555bf78.js";import{m as me,c as Q,l as A,H as C,L as ue,q as J,w as ve,o as ge,p as de,d as fe,e as he}from"./use-translate-71d4880c.js";import{u as we}from"./use-expose-80cfd2b2.js";import{I as Pe}from"./index-1ef61aa2.js";import{a as Se,S as ye}from"./index-a26cde52.js";import{P as be}from"./index-e88b099c.js";import{u as Ce}from"./use-touch-4e22f945.js";import{I as Ie}from"./index-1122429d.js";import{L as xe}from"./index-2b75ebd8.js";import{A as ee,H as oe,y as p,D as H,u as O,e as m,M as Te,q as Ye,B as te,Q as Xe}from"./vue-libs-19c20d28.js";import{d as k,n as q,t as Y,b as Oe,c as D,u as F,m as U}from"./with-install-560d59bf.js";import{T as V,L as Ze,H as Re}from"./constant-ee6e27d7.js";import{c as pe}from"./interceptor-5424332a.js";const G=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ze=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),B=Q("image-preview")[1],K=2.6,He=ee({props:{src:String,show:Boolean,active:Number,minZoom:k(q),maxZoom:k(q),rootWidth:k(Number),rootHeight:k(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickOverlay:Boolean},emits:["scale","close","longPress"],setup(e,{emit:l,slots:u}){const o=oe({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),i=Ce(),I=p(),Z=p(),P=p(!1),d=p(!1);let S=0;const N=H(()=>{const{scale:t,moveX:a,moveY:s,moving:c,zooming:r,initializing:h}=o,z={transitionDuration:r||c||h?"0s":".3s"};return(t!==1||d.value)&&(z.transform=`matrix(${t}, 0, 0, ${t}, ${a}, ${s})`),z}),v=H(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:a}=e,s=P.value?a/o.imageRatio:t;return Math.max(0,(o.scale*s-t)/2)}return 0}),w=H(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:a}=e,s=P.value?a:t*o.imageRatio;return Math.max(0,(o.scale*s-a)/2)}return 0}),x=(t,a)=>{var s;if(t=C(t,+e.minZoom,+e.maxZoom+1),t!==o.scale){const c=t/o.scale;if(o.scale=t,a){const r=J((s=I.value)==null?void 0:s.$el),h={x:r.width*.5,y:r.height*.5},z=o.moveX-(a.x-r.left-h.x)*(c-1),le=o.moveY-(a.y-r.top-h.y)*(c-1);o.moveX=C(z,-v.value,v.value),o.moveY=C(le,-w.value,w.value)}else o.moveX=0,o.moveY=d.value?S:0;l("scale",{scale:t,index:e.active})}},T=()=>{x(1)},W=()=>{const t=o.scale>1?1:2;x(t,t===2||d.value?{x:i.startX.value,y:i.startY.value}:void 0)};let y,b,n,f,g,E,R,L,$=!1;const ae=t=>{const{touches:a}=t;if(y=a.length,y===2&&e.disableZoom)return;const{offsetX:s}=i;i.start(t),b=o.moveX,n=o.moveY,L=Date.now(),$=!1,o.moving=y===1&&(o.scale!==1||d.value),o.zooming=y===2&&!s.value,o.zooming&&(f=o.scale,g=G(a))},ie=t=>{const{touches:a}=t;if(i.move(t),o.moving){const{deltaX:s,deltaY:c}=i,r=s.value+b,h=c.value+n;if((r>v.value||r<-v.value)&&!$&&i.isHorizontal()){o.moving=!1;return}$=!0,A(t,!0),o.moveX=C(r,-v.value,v.value),o.moveY=C(h,-w.value,w.value)}if(o.zooming&&(A(t,!0),a.length===2)){const s=G(a),c=f*s/g;E=ze(a),x(c,E)}},ne=t=>{var h;if(y>1)return;const{offsetX:a,offsetY:s}=i,c=Date.now()-L,r=250;if(a.value<V&&s.value<V)if(c<r)if(e.doubleScale)if(R)clearTimeout(R),R=null,W();else{if(!e.closeOnClickOverlay&&t.target===((h=Z.value)==null?void 0:h.$el))return;R=setTimeout(()=>{l("close"),R=null},r)}else l("close");else c>Ze&&l("longPress")},_=t=>{let a=!1;if((o.moving||o.zooming)&&(a=!0,o.moving&&b===o.moveX&&n===o.moveY&&(a=!1),!t.touches.length)){o.zooming&&(o.moveX=C(o.moveX,-v.value,v.value),o.moveY=C(o.moveY,-w.value,w.value),o.zooming=!1),o.moving=!1,b=0,n=0,f=1,o.scale<1&&T();const s=+e.maxZoom;o.scale>s&&x(s,E)}A(t,a),ne(t),i.reset()},j=()=>{const{rootWidth:t,rootHeight:a}=e,s=a/t,{imageRatio:c}=o;P.value=o.imageRatio>s&&c<K,d.value=o.imageRatio>s&&c>=K,d.value&&(S=(c*t-a)/2,o.moveY=S,o.initializing=!0,ue(()=>{o.initializing=!1})),T()},se=t=>{const{naturalWidth:a,naturalHeight:s}=t.target;o.imageRatio=s/a,j()};return O(()=>e.active,T),O(()=>e.show,t=>{t||T()}),O(()=>[e.rootWidth,e.rootHeight],j),me("touchmove",ie,{target:H(()=>{var t;return(t=Z.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>m(xe,{type:"spinner"},null)};return m(Se,{ref:Z,class:B("swipe-item"),onTouchstartPassive:ae,onTouchend:_,onTouchcancel:_},{default:()=>[u.image?m("div",{class:B("image-wrap")},[u.image({src:e.src})]):m(Ie,{ref:I,src:e.src,fit:"contain",class:B("image",{vertical:P.value}),style:N.value,onLoad:se},t)]})}}});function ke(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const[De,X]=Q("image-preview"),Me=["show","teleport","transition","overlayStyle","closeOnPopstate"],Ne={show:Boolean,loop:Y,images:Oe(),minZoom:D(1/3),maxZoom:D(3),overlay:Y,closeable:Boolean,showIndex:Y,className:F,closeIcon:U("clear"),transition:String,beforeClose:Function,doubleScale:Y,overlayClass:F,overlayStyle:Object,swipeDuration:D(300),startPosition:D(0),showIndicators:Boolean,closeOnPopstate:Y,closeOnClickOverlay:Y,closeIconPosition:U("top-right"),teleport:[String,Object]},We=ee({name:De,props:Ne,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:l,slots:u}){const o=p(),i=oe({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),I=()=>{if(o.value){const n=J(o.value.$el);i.rootWidth=n.width,i.rootHeight=n.height,o.value.resize()}},Z=n=>l("scale",n),P=n=>l("update:show",n),d=()=>{pe(e.beforeClose,{args:[i.active],done:()=>P(!1)})},S=n=>{n!==i.active&&(i.active=n,l("change",n))},N=()=>{if(e.showIndex)return m("div",{class:X("index")},[u.index?u.index({index:i.active}):`${i.active+1} / ${e.images.length}`])},v=()=>{if(u.cover)return m("div",{class:X("cover")},[u.cover()])},w=()=>{i.disableZoom=!0},x=()=>{i.disableZoom=!1},T=()=>{let n;return m(ye,{ref:o,lazyRender:!0,loop:e.loop,class:X("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:S,onDragEnd:x,onDragStart:w},ke(n=e.images.map((f,g)=>m(He,{src:f,show:e.show,active:i.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,disableZoom:i.disableZoom,doubleScale:e.doubleScale,closeOnClickOverlay:e.closeOnClickOverlay,onScale:Z,onClose:d,onLongPress:()=>l("longPress",{index:g})},{image:u.image})))?n:{default:()=>[n]})},W=()=>{if(e.closeable)return m(Pe,{role:"button",name:e.closeIcon,class:[X("close-icon",e.closeIconPosition),Re],onClick:d},null)},y=()=>l("closed"),b=(n,f)=>{var g;return(g=o.value)==null?void 0:g.swipeTo(n,f)};return we({swipeTo:b}),Te(I),O([ve,ge],I),O(()=>e.startPosition,n=>S(+n)),O(()=>e.show,n=>{const{images:f,startPosition:g}=e;n?(S(+g),Ye(()=>{I(),b(+g,{immediate:!0})})):l("close",{index:i.active,url:f[i.active]})}),()=>m(be,te({class:[X(),e.className],overlayClass:[X("overlay"),e.overlayClass],onClosed:y,"onUpdate:show":P},de(e,Me)),{default:()=>[W(),T(),N(),v()]})}});let M;const Ee={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function $e(){({instance:M}=ce({setup(){const{state:e,toggle:l}=re(),u=()=>{e.images=[]};return()=>m(We,te(e,{onClosed:u,"onUpdate:show":l}),null)}}))}const eo=(e,l=0)=>{if(fe)return M||$e(),e=Array.isArray(e)?{images:e,startPosition:l}:e,M.open(he({},Ee,e)),M};export{We as _,eo as s};
